<style>
  .dashboard,
  .dashboard .tab-pane,
  .dashboard .tab-pane > div {
    height: 100%;
  }
  .dashboard .nav-tabs {
    margin: 0;
    padding-right: 2em;
  }
  .dashboard .nav-tabs > li:last-child {
    float: right;
  }
  .dashboard .nav-tabs li .dropdown {
    display: inline-block;
    margin-right: 35px;
  }
  .dashboard .nav-tabs li .dropdown a {
    color: #000;
  }
  .dashboard .nav-tabs li a {
    cursor: default;
    font-weight: 600;
  }
  .dashboard .nav-tabs .dropdown-menu a:hover {
    cursor: pointer;
    background-color: transparent;
    color: #fff;
  }
  .dashboard .tab-content {
    height: calc(100% - 40px);
    padding: 5px;
  }
  .dashboard .tab-pane {
    height: 100%;
  }
  .vis-wrapper {
    background: #fff;
    border: 1px solid #ddd;
    margin: 10px;
    padding: 5px;
  }
  .vis-wrapper .vis-title {
    border-bottom: 1px solid #152935;
    color: #152935;
    font-size: 1.25em;
    font-weight: 400;
    padding: 10px 0px 5px;
  }
  .vis-wrapper .vis-stage {
    overflow: hidden;
    position: relative;
    margin: 10px 0px 5px;
  }
  .vis-wrapper-dist1 {
    height: 100%; /*calc(60vh - 90px);*/
    margin-left: 0px;
  }
  .vis-wrapper-dist2 {
    height: calc(40vh - 90px);
    margin-left: 0px;
    overflow: auto;
  }
  .vis-wrapper-dist3,
  .vis-wrapper-dist4 {
    height: 100%; /%calc(50vh - 90px);%/
    margin-right: 0px;
  }
  .vis-wrapper-gt1 {
    height: calc(100vh - 160px);
    margin-left: 0px;
  }
  .vis-wrapper-gt2 {
    height: calc(100vh - 290px);
  }
  .vis-wrapper-gt2 button {
    width: 100%;
    height: 75px;
    margin-bottom: 20px;
  }
  .vis-wrapper-gt3,
  .vis-wrapper-gt4 {
    height: calc(50vh - 155px);
  }
  .vis-wrapper-gt5,
  .vis-wrapper-gt6 {
    height: calc(50vh - 155px);
    margin-right: 0px;
  }
  .vis-wrapper-gt7 {
    height: 100px;
    margin-right: 0px;
  }
  .vis-wrapper-gt8,
  .vis-wrapper-gt9,
  .vis-wrapper-gt10 {
    height: calc(40vh - 181px);
  }
  .vis-wrapper-gt11 {
    height: calc(50vh - 150px);
  }
  .vis-wrapper-gt12,
  .vis-wrapper-gt13 {
    height: calc(33vh - 175px);
    margin-right: 0px;
  }
  .gauge {
    margin: 10px 0 20px 0;
    text-align: center;
    height: 100%;
  }
  .gauge img {
    height: 90%;
    width: 90%;
  }
</style>
<div pixiedust="{{pd_controls|htmlAttribute}}" class="dashboard">
  <ul class="nav nav-tabs">
    <li><a id="nav-dist-{{prefix}}" data-toggle="tab" href="#pane-dist-{{prefix}}" pixiedust>
        Disruption Dashboard
        <target pd_target="pane-dist1{{prefix}}" pd_entity
          pd_options="handlerId=mapView;rendererId=mapbox;keyFields=lat,long;valueFields=count;aggregation=SUM;rowCount=500;mapboxtoken=pk.eyJ1IjoidmFiYXJib3NhIiwiYSI6ImNqMDE4a2lrZzA2NjkzMm94bXZqdTk4amYifQ.rfxH46T8UoWwxRegb3_X6g">
          <!-- "handlerId=mapView;rendererId=mapbox;keyFields=lat,long;valueFields=count;kind=densitymap;preserveCols=key;aggregation=COUNT;rowCount=1000;nostore_figureOnly=true;mapboxtoken=pk.eyJ1IjoidmFiYXJib3NhIiwiYSI6ImNqMDE4a2lrZzA2NjkzMm94bXZqdTk4amYifQ.rfxH46T8UoWwxRegb3_X6g"> -->
            <!--<pd_event_handler pd_script="self.alert=self.getAlert(eventInfo['key']) if 'key' in eventInfo else None">
              <target pd_target="pane-dist2{{prefix}}" pd_entity="alert" pd_options="handlerId=dataframe;table_noschema=true"/>
              <target pd_target="pane-dist3{{prefix}}" pd_script="self.showWatsonResults()"/>
            </pd_event_handler>-->
        </target>
       <!-- <target pd_target="pane-dist2{{prefix}}" pd_entity pd_options="handlerId=dataframe;table_noschema=true"/> -->
        <target pd_target="pane-dist3{{prefix}}" pd_entity="newsstories" pd_options="handlerId=dataframe;table_noschema=true"/>
        <target pd_target="pane-dist4{{prefix}}" pd_entity pd_options="handlerId=barChart;rendererId=matplotlib;keyFields=weekStart;valueFields=count;aggregation=SUM;rowCount=1000;legend=true;nostore_figureOnly=true;clusterby=type;charttype=stacked"/>
      </a></li>
    <li><a id="nav-gt-{{prefix}}" data-toggle="tab" href="#pane-gt-{{prefix}}" pixiedust>
        GroundTruth Explorer
        <target pd_target="pane-cu1{{prefix}}" pd_entity="violentalerts" pd_options="handlerId=mapView;rendererId=mapbox;keyFields=lat,long;valueFields=count;aggregation=SUM;rowCount=500;kind=densitymap;mapboxtoken=pk.eyJ1IjoidmFiYXJib3NhIiwiYSI6ImNqMDE4a2lrZzA2NjkzMm94bXZqdTk4amYifQ.rfxH46T8UoWwxRegb3_X6g"/>
        <target pd_target="pane-cu2{{prefix}}" pd_entity pd_options="handlerId=barChart;keyFields=weekStart;valueFields=count;aggregation=SUM;rowCount=500;clusterby=eventType;timeseries=false;charttype=stacked;nostore_figureOnly=true"/>
        <target pd_target="pane-cu3{{prefix}}" pd_entity="newsstories" pd_options="handlerId=dataframe;table_noschema=true"/>
        <target pd_target="pane-cu4{{prefix}}" pd_entity="hashtags" pd_options="handlerId=dataframe;table_noschema=true"/>
        </a></li>
    <li class="disabled">
      <div class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown" href="#">{{entity.countryName}}
          <span class="caret"></span>
        </a>
        <ul class="dropdown-menu">
          <li><a href="#">
              Egypt
              <pd_script>
self.updateCountry("23424802")
              </pd_script>
            </a></li>
          <li><a href="#">
              Colombia
              <pd_script>
self.updateCountry("23424787")
              </pd_script>
            </a></li>
        </ul>
      </div>
      <input id = "sdDate{{prefix}}" type="date" name="startDate" value="{{this.startDate.strftime("%Y-%m-%d")}}">
      <input id = "edDate{{prefix}}" type="date" name="endDate" value="{{this.endDate.strftime("%Y-%m-%d")}}">
      <button type="submit" class="btn btn-primary">
          Go
          <pd_script>
from datetime import datetime
self.endDate = datetime.strptime("$val(edDate{{prefix}})", "%Y-%m-%d")
self.startDate = datetime.strptime("$val(sdDate{{prefix}})", "%Y-%m-%d")
self.onCountrySelected()
          </pd_script>
        </button>
    </li>
  </ul>

  <div class="tab-content container-fluid">
    <div id="pane-dist-{{prefix}}" class="row tab-pane tab-pane-dist fade in active" >
      <div class="row" style="height:12%" id="gaugerow">
      </div>
      <div class="col-sm-7" >
        <div class="row" style="height:88%">
          <div class="col-sm-12" style="height:100%">
            <div id="pane-dist1{{prefix}}" class="vis-wrapper vis-wrapper-dist1"></div>
          </div>
        </div>
        <!--<div class="row">
          <div class="col-sm-12">
            <div id="pane-dist2{{prefix}}" class="vis-wrapper vis-wrapper-dist2"></div>
          </div>
        </div>-->
      </div>
      <div class="col-sm-5" >
        <div class="row" style="height:44%">
          <div class="col-sm-12" style="height:100%">
            <div id="pane-dist3{{prefix}}" class="vis-wrapper vis-wrapper-dist3"></div>
          </div>
        </div>
        <div class="row" style="height:44%">
          <div class="col-sm-12" style="height:100%">
            <div id="pane-dist4{{prefix}}" class="vis-wrapper vis-wrapper-dist4"></div>
          </div>
        </div>
      </div>
    </div>
    
    <div id="pane-gt-{{prefix}}" class="row tab-pane tab-pane-gt" >
      <div class="col-md-2">
        <div class="row">
          <div class="col-sm-12">
            <div id="pane-gt1{{prefix}}" class="vis-wrapper vis-wrapper-gt1">
              <ul class="nav nav-pills nav-stacked">
                <li class="active" role="presentation"><a data-toggle="tab" data-pt-cat="civilunrest" pixiedust href="#pane-gt-cu-{{prefix}}">
                    Civil Unrest
                    <target pd_target="pane-cu1{{prefix}}" pd_entity="violentalerts" pd_options="handlerId=mapView;rendererId=mapbox;keyFields=lat,long;valueFields=count;aggregation=SUM;rowCount=500;kind=densitymap;mapboxtoken=pk.eyJ1IjoidmFiYXJib3NhIiwiYSI6ImNqMDE4a2lrZzA2NjkzMm94bXZqdTk4amYifQ.rfxH46T8UoWwxRegb3_X6g"/>
                    <target pd_target="pane-cu2{{prefix}}" pd_entity pd_options="handlerId=barChart;keyFields=weekStart;valueFields=count;aggregation=SUM;rowCount=500;clusterby=eventType;timeseries=false;charttype=stacked;nostore_figureOnly=true"/>
                    <target pd_target="pane-cu3{{prefix}}" pd_entity="newsstories" pd_options="handlerId=dataframe;table_noschema=true"/>
                    <target pd_target="pane-cu4{{prefix}}" pd_entity="hashtags" pd_options="handlerId=dataframe;table_noschema=true"/>
                  </a></li>
                <li role="presentation"><a data-toggle="tab" data-pt-cat="environment" pixiedust href="#pane-gt-env-{{prefix}}">
                  Environment
                    <target pd_target="pane-env3{{prefix}}" pd_entity="newsstories" pd_options="handlerId=dataframe;table_noschema=true"/>
                    <target pd_target="pane-env4{{prefix}}" pd_entity="hashtags" pd_options="handlerId=dataframe;table_noschema=true"/>
                    <target pd_target="pane-env12{{prefix}}" pd_entity="temperature" pd_options="handlerId=lineChart;rendererId=matplotlib;keyFields=time;valueFields=value;aggregation=SUM;rowCount=500;legend=false;timeseries=false"/>
                    <target pd_target="pane-env13{{prefix}}" pd_entity="precipitation" pd_options="handlerId=barChart;keyFields=time;valueFields=value;aggregation=SUM;rowCount=500;legend=false;timeseries=false"/>
                  </a></li>
                <li role="presentation"><a data-toggle="tab" data-pt-cat="infrastructure" pixiedust href="#pane-gt-inner1-{{prefix}}">Infrastructure</a></li>
                <li role="presentation"><a data-toggle="tab" data-pt-cat="food" pixiedust href="#pane-gt-inner1-{{prefix}}">Food</a></li>
                <li role="presentation"><a data-toggle="tab" data-pt-cat="crime" pixiedust href="#pane-gt-inner1-{{prefix}}">Crime</a></li>
                <li role="presentation"><a data-toggle="tab" data-pt-cat="socialissues" pixiedust href="#pane-gt-inner1-{{prefix}}">Social Issues</a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-10">
        <div class="row tab-content" style="height: 85%">
            <div id="pane-gt-cu-{{prefix}}" class="row tab-pane fade in active">
                <div class="col-md-6">
                  <div class="row">
                    <div class="col-sm-12">
                      <div id="pane-cu1{{prefix}}" class="vis-wrapper vis-wrapper-gt4"></div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-sm-12">
                      <div id="pane-cu3{{prefix}}" class="vis-wrapper vis-wrapper-gt3"></div>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="row">
                    <div class="col-sm-12">
                      <div id="pane-cu2{{prefix}}" class="vis-wrapper vis-wrapper-gt5"></div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-sm-12">
                      <div id="pane-cu4{{prefix}}" class="vis-wrapper vis-wrapper-gt6"></div>
                    </div>
                  </div>
                </div>
            </div>
            <div id="pane-gt-env-{{prefix}}" class="row tab-pane">
                <div class="col-md-6">
                  <div class="row">
                    <div class="col-sm-12">
                      <div id="pane-env1{{prefix}}" class="vis-wrapper vis-wrapper-gt4">
                        <img src="https://raw.githubusercontent.com/nicklondhe/pixiedust_peacetech/quotes-fix/pixiedust_peacetech/img/giphy.gif" height="100%" width="100%"></img>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-sm-12">
                      <div id="pane-env3{{prefix}}" class="vis-wrapper vis-wrapper-gt3"></div>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="row">
                    <div class="col-sm-12">
                      <div id="pane-env2{{prefix}}" class="vis-wrapper vis-wrapper-gt5">
                        <div class="row">
                          <div class="col-sm-12">
                            <div id="pane-env12{{prefix}}" class="vis-wrapper vis-wrapper-gt12">
                            </div>
                          </div>
                        </div>
                        <div class="row">
                          <div class="col-sm-12">
                            <div id="pane-env13{{prefix}}" class="vis-wrapper vis-wrapper-gt13">
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-sm-12">
                      <div id="pane-env4{{prefix}}" class="vis-wrapper vis-wrapper-gt6"></div>
                    </div>
                  </div>
                </div>
            </div>
            <div id="pane-gt-inner1-{{prefix}}" class="row tab-pane">
                <div class="col-md-6">
                  <div class="row">
                    <div class="col-sm-12">
                      <div id="pane-gt3{{prefix}}" class="vis-wrapper vis-wrapper-gt4"></div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-sm-12">
                      <div id="pane-gt4{{prefix}}" class="vis-wrapper vis-wrapper-gt3"></div>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="row">
                    <div class="col-sm-12">
                      <div id="pane-gt5{{prefix}}" class="vis-wrapper vis-wrapper-gt5">
                        Visualization type <br/>
                        List (HTML formatted) <br/>
                        Shows top news stories
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-sm-12">
                      <div id="pane-gt6{{prefix}}" class="vis-wrapper vis-wrapper-gt6">
                        Visualization type <br/>
                        Master-detail view Master <br/>
                        List of selectable tabs showing top hashtags Detail <br/>
                        List of top tweets
                      </div>
                    </div>
                  </div>
                </div>
            </div>
            <div id="pane-gt-inner2-{{prefix}}" class="row tab-pane">
                <div class="col-md-6">
                  <div class="row">
                    <div class="col-sm-12">
                      <div id="pane-gt8{{prefix}}" class="vis-wrapper vis-wrapper-gt8">
                        Visualization type <br/>
                        List (HTML formatted) <br/>
                        Show agencies / numbers to contact in case of failures
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-sm-12">
                      <div id="pane-gt9{{prefix}}" class="vis-wrapper vis-wrapper-gt9">
                        Visualization type <br/>
                        List (HTML formatted) <br/>
                        Shows top news stories
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-sm-12">
                      <div id="pane-gt10{{prefix}}" class="vis-wrapper vis-wrapper-gt10">
                        Visualization type <br/>
                        Master-detail view Master <br/>
                        List of selectable tabs showing top hashtags Detail <br/>
                        List of top tweets
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="row">
                    <div class="col-sm-12">
                      <div id="pane-gt11{{prefix}}" class="vis-wrapper vis-wrapper-gt11">
                        Visualization type <br/>
                        Gif or Movie showing change in satellite imagery of the area
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-sm-12">
                      <div id="pane-gt12{{prefix}}" class="vis-wrapper vis-wrapper-gt12">
                        Time series <br/>
                        Y-axis - temperature <br/>
                        X-axis - Day
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-sm-12">
                      <div id="pane-gt13{{prefix}}" class="vis-wrapper vis-wrapper-gt13">
                        Time series <br/>
                        Y-axis - precipitation <br/>
                        X-axis - Day
                      </div>
                    </div>
                  </div>
                </div>
            </div>
        </div>
        <div class="row">
          <div class="col-md-12">
            <div id="pane-gt7{{prefix}}" class="vis-wrapper vis-wrapper-gt7">
              <p>{{this.commentary.get_value(0,'text')}}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script>
  //hard coded values for now
  var temp = '<div class="gauge col-sm-2"><img src="https://raw.githubusercontent.com/nicklondhe/pixiedust_peacetech/master/pixiedust_peacetech/img/Gauge%20-%20COLOR.png"/><p><h4>TITLE</h4></p></div>';
  var indicValues = {
    "Civil Unrest" : 70,
    "Environment" : 90,
    "Infrastructure" : 20,
    "Social Issues" : 70,
    "Crime" : 20,
    "Food" : 20
  }

  function setTopGauges(divid) {
    $("#"+divid).empty();
      for (val in indicValues) {
         var c = 'red';
        if (indicValues[val] < 40) c = 'green';
        else if (indicValues[val] < 80) c = 'yellow';
        console.info(val + " -- " + indicValues[val] + " ---- " + c);
        var h = temp.replace(/COLOR/g, c).replace(/TITLE/g, val);
        $('#'+divid).append(h);
      }
  }

  var catValues = {
    "food": {
      "Food price": 80,
      "Food production": 30,
      "Crop failure": 60
    },
    "infrastructure": {
      "Transportation": 80,
      "Telecom": 60,
      "Power": 30
    },
    "environment": {
      "Food": 80,
      "Natural resources": 30,
      "Drought": 60,
      "Temperature": 75,
      "Pollution": 10
    },
    "civilunrest": {
      "Violent": 20,
      "Non-violent": 60
    },
    "crime": {
      "Violent": 30,
      "Non-violent": 50,
      "Terrorism": 70,
    },
    "socialissues": {
      "Missing persons": 90,
      "Corruption": 60,
      "Migration & displacement": 10,
      "Discrimination": 70,
      "Gender based violence": 75
    }
  }
  function setGauges(values) {
    $('#pane-gt2{{prefix}}').empty();
    if (values) {
      var c = 'green';
      for (val in values) {
        if (values[val] < 40) c = 'red';
        else if (values[val] < 80) c = 'yellow';

        var h = temp.replace(/COLOR/g, c).replace(/TITLE/g, val)
        $('#pane-gt2{{prefix}}').append(h);
      }
    }
  }
  $('#nav-dist-{{prefix}}').click();
  setTopGauges("gaugerow")
  /*$('#pane-gt1{{prefix}} a').on('click', function() {
    var cat = $(this).data('ptCat');
    setGauges(catValues[cat]);
  });
  setGauges(catValues['food']); */
</script>
